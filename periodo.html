<!DOCTYPE html>

    <head>

        <meta charset="utf-8">
        <meta name="viewport" content="width=device-width, initial-scale=1.0">
        <link rel="manifest" href="manifest.json">
        <link rel="stylesheet" href="recursos/barraNavegacion.css">
        <link rel="stylesheet" href="recursos/estilo.css">
        <link rel="shortcut icon" href="recursos/favicon.ico" type="image/x-icon">
        <link rel="icon" href="recursos/favicon.ico" type="image/x-icon">
        <link href="https://fonts.googleapis.com/css?family=Bitter:400i|Fira+Code|Roboto|Ubuntu|Ubuntu+Mono&display=swap" rel="stylesheet">

        <!-- Chrome, Firefox OS and Opera -->
        <meta name="theme-color" content="#d8d8d8">
        <!-- Windows Phone -->
        <meta name="msapplication-navbutton-color" content="#d8d8d8">
        <!-- iOS Safari -->
        <meta name="apple-mobile-web-app-status-bar-style" content="#d8d8d8">

        <!-- Latest compiled and minified CSS -->
        <link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/bootstrap/4.4.1/css/bootstrap.min.css">

        <!-- jQuery library -->
        <script src="https://ajax.googleapis.com/ajax/libs/jquery/3.4.1/jquery.min.js"></script>

        <!-- Popper JS -->
        <script src="https://cdnjs.cloudflare.com/ajax/libs/popper.js/1.16.0/umd/popper.min.js"></script>

        <!-- Latest compiled JavaScript -->
        <script src="https://maxcdn.bootstrapcdn.com/bootstrap/4.4.1/js/bootstrap.min.js"></script>

        <!-- The core Firebase JS SDK is always required and must be listed first -->
        <script src="https://www.gstatic.com/firebasejs/7.7.0/firebase-app.js"></script>

        <!-- TODO: Add SDKs for Firebase products that you want to use
        https://firebase.google.com/docs/web/setup#available-libraries -->
        <script src="https://www.gstatic.com/firebasejs/7.7.0/firebase-analytics.js"></script>
        <script defer src="https://www.gstatic.com/firebasejs/7.7.0/firebase-auth.js"></script>
        <script defer src="https://www.gstatic.com/firebasejs/7.7.0/firebase-firestore.js"></script>

        <!--Importación de librerías-->
        <script src="CalculadoraAPI/calculadora.js"></script>
        <script src="CalculadoraAPI/editorDeTabla.js"></script>
        <script src="CalculadoraAPI/extractorDeDatos.js"></script>
        <script src="CalculadoraAPI/traductorCSV.js"></script>
        <script src="index.js"></script>

        <!--scripts-->
        <script>
            calculadora = new CalculadoraIndice();
            editorDeTabla = new EditorDeTabla();
            extractorDeDatos = new ExtractorDeDatos();
            traductorCSV = new TraductorDeCSV();
            var servidor = new ServidorDeFirebase();

            function iniciarPagina(){
                //cargarPWA();
                cambiarTabla();

                editorDeTabla.borrarDatos();
                servidor.inicializar("periodo");

                boton = document.getElementById("botonDeSeleccion");
                boton.value = "Periodo";
                boton.innerHTML = "Periodo";

                //editorDeTabla.agregarFilas(8);
            }

            function cambiarTabla(){
                editorDeTabla.editarTabla();
            }

            function calcularIndice(){
                arreglo = extractorDeDatos.extraerDatos();

                if(servidor.usuarioActivo()){
                    crearJSON();
                }

                if(arreglo){
                    document.getElementById("indice").value = calculadora.calcularIndicePeriodo(arreglo);
                    
                    redondeado = (parseFloat(document.getElementById("indice").value)).toFixed(0);
                    elemento = document.getElementById("indiceRedondeado");
                    elemento.value = redondeado;

                    if(redondeado < 65){
                        elemento.style = "color: crimson;";
                    }
                    else{
                        elemento.style= "color: #009688;";
                    }

                    //document.getElementById("resultados").style = "transition: all 1s ease-out;";
                    document.getElementById("resultados").style.display = "block";
                }
                
            }    

            function agregar(){
                elemento = document.getElementById("numeroDeClases");
                valorActual = parseInt(elemento.value);

                if( (valorActual+1) < ( parseInt(elemento.max) + 1 ) ){
                    elemento.value = valorActual + 1;
                    editorDeTabla.editarTabla();
                }
            }

            function quitar(){
                elemento = document.getElementById("numeroDeClases");
                valorActual = parseInt(elemento.value);

                if(valorActual > parseInt(elemento.min)){
                    elemento.value = valorActual - 1;
                    editorDeTabla.editarTabla();
                }
            }

            function limitarDatos(elemento){
                valorActual = parseInt(elemento.value);

                if( valorActual > parseInt(elemento.max) ){
                    elemento.value = parseInt(elemento.max);
                }

                cambiarTabla();
            }

            function crearJSON(){
                csv = extractorDeDatos.extraerDatos("guardar");
                json = traductorCSV.csv2json(csv);

                servidor.enviarDatos(json, "periodo");
            }

            function registrarUsuario(){
                servidor.ingresar();
            }

            function quitarUsuarioActual(){
                servidor.logout();
                editorDeTabla.borrarDatos();
            }

            function recargarDatos(){
                //console.log(servidor.periodo);
                editorDeTabla.llenarDatos( traductorCSV.json2arreglo(servidor.periodo) );
            }

        </script>

        <title>Índice de Periodo - Calculadora de Índice Académico</title>

    </head>

    <body onload="iniciarPagina()">

        <!--Cuerpo de la clase-->
        <div class="jumbotron" id="cuerpo">
            <div class="container col-sm-4"><h1><strong>Índice de Periodo:</strong></h1></div>
            <div class="container text-center" id="creadorTabla">
                <div class="row col-sm-6">
                    <div class="col"><h4>Clases cursadas durante el periodo:</h4></div>
                    <div class="container col">
                        <div class="talbe responsive">
                            <table class="table" id="spinner">
                                <tbody>
                                   <tr>
                                        <td>
                                            <button id="menos" class="botonesDeSpinner" onclick="quitar()">-</button>
                                        </td>
                                        <td>
                                            <input class="form-control" type="number" id="numeroDeClases" min="1" max="10" value="4" oninput="limitarDatos(this)">
                                        </td>
                                        <td>
                                            <button id="mas" class="botonesDeSpinner" onclick="agregar()">+</button>
                                        </td>
                                    </tr> 
                                </tbody>
                                
                            </table>
                        </div>
                    </div>
                </div>
                <div class="row justify-content-center">
                    <!--Tabla de Datos-->
                    <div class="container col-sm-6">
                        <div class="table responsive">
                            <table class="table table-bordered" id="tabla">
                                <thead>
                                    <tr>
                                        <th>Clase</th>
                                        <th>Nota</th>
                                        <th>UV</th>
                                    </tr>
                                </thead>
                                <tbody id="datos">
                                    <tr>
                                        <td>
                                            <input class="form-control" type="text" placeholder="Clase1" style="font-style: italic;"/>
                                        </td>
                                        <td>
                                            <input class="form-control" type="number" min="0" max ="100" oninput="limitarDatos(this)"/>
                                        </td>
                                        <td>
                                            <input class="form-control" type="number" min="1" max="7" oninput="limitarDatos(this)"/>
                                        </td>
                                    </tr>
                                </tbody>
                            </table>
                        </div>
                    </div>

                    <!--Resultados-->
                    <div class="container col-sm-4">
                        <div class="table responsive" id="resultados">
                            <table class="table">
                                <tbody>
                                    <tr>
                                        <td>
                                            <p>Índice de Periodo:</p>
                                            <input class="form-control" type="text" readonly ="true" id="indice" class="redondeado"/>
                                              
                                        </td>
                                    </tr>
                                    <tr>
                                        <td>
                                            <p id="titulo">Redondeado:</p>
                                            <input class="form-control" type="text" readonly="true" id="indiceRedondeado" class="redondeado"/>
                                        </td>
                                    </tr>
                                </tbody>
                            </table>
                        </div>

                        <div class="table responsive" id="miscelaneos">
                            <table class="table">
                                <tbody>
                                    <tr>
                                        <td>
                                            <button type="button" onclick="calcularIndice()" id="botonCalcular">Calcular Índice de Periodo</button>
                                        </td>
                                    </tr>
                                    <tr>
                                        <td>
                                            <label for="google" id="sign-in" style="display: none;">Ingresar con una cuenta de Google</label>
                                            <button class="botones" id="google" onclick="registrarUsuario()" style="display: none;"></button>
                                        </td>
                                        <tr>
                                            <td>
                                                <div id="logged-in" style="display: none;"></div>
                                            </td>
                                            <tr>
                                                <td>
                                                    <label for="logout" id="salir" style="display: none;">Cerrar Sesión</label>
                                                    <button type="button" onclick="quitarUsuarioActual()" id="logout" style="display: none;"></button>
                                                </td>
                                                <td>
                                                    <button class="botones" type="button" id="recargar" onclick="recargarDatos()" style="display: none;">Cargar datos otra vez</button>
                                                </td>
                                            </tr>
                                        </tr>
                                    </tr>
                                </tbody>
                            </table>
                        </div>
                        <br><br>
                        
                        <br>
                        <br>
                        <br>
                        
                        
                        
                        <br>
                        <br>
                        <br>
                        
                    </div>
                    

                </div>


            </div>

            
            
        </div>

        <!--Barra de Navegación Escritorio-->
        <div class="row fixed-bottom bg-dark" id="navbar-desktop">
            <div class="col-sm-1"><a href="informacion.html">
                <img src="recursos/info.png">
            </a></div>
            <div class="col-sm-3" id="textoNormal"><a>Índice:</a></div>
            <div class="col-sm-4"><a href="index.html">Global</a></div>
            <div class="col-sm-4" id="seleccionado"><a href="periodo.html">Periodo</a></div>
        </div>

        <!--Barra de Navegación Móvil-->
        <div class="row fixed-bottom bg-dark" id="navbar-mobile">
            <div class="col-2"style="padding-left: 12px; width: 25%;"><a href="informacion.html">
                <img src="recursos/info.png">
            </a></div>
            <div class="col-4" id="textoNormal"><a>Índice:</a></div>
            <div class="col">
                <div class="dropup">
                    <button type="button" value="Seleccionar" class="btn btn-primary dropdown-toggle" data-toggle="dropdown" id="botonDeSeleccion"></button>
                    <div class="dropdown-menu" id="opciones">
                        <a class="dropdown-item" href="index.html">Global</a>
                        <a class="dropdown-item" href="periodo.html" id="seleccionado">Periodo</a>
                    </div>
                </div>
            </div>
    </body>

</html>